---
title: "Exploring the composition of lithic assemblages in Mesolithic south-eastern Norway"
author:
  - Isak Roalkvam:
      email: isak.roalkvam@iakh.uio.no
      institute: [UiO]
      correspondence: true
institute:
  - UiO: University of Oslo
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
    bookdown::html_document2:
      fig_caption: yes
      reference_docx: "../templates/template.docx" # Insert path for the DOCX file
      pandoc_args:
      - --lua-filter=../templates/scholarly-metadata.lua
      - --lua-filter=../templates/author-info-blocks.lua
      - --lua-filter=../templates/pagebreak.lua
bibliography: references.bib
csl: "../templates/journal-of-archaeological-science.csl" # Insert path for the bib-style
---

<!-- This is the format for text comments that will be ignored during renderings. Do not put R code in these comments because it will not be ignored. -->

<!-- The following code chunk defines some general settings how code chunks should behave. -->

```{r setup, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  comment = "#>",
  fig.width = 9,
  fig.path = "../figures/",
  dpi = 300
)
```

```{r libraries, eval = TRUE}
library(tidyverse)
library(patchwork)
library(gt)
library(FactoMineR)
library(factoextra)
```

<!-- Here's some example analysis code: -->

# Introduction

Previous studies of lithic artefacts in Norway have typically had a focus on chronological trends associated with formal tool types [@reitan2016], involved refit-studies of the entirety of individual assemblages [@skar1986], or in-depth analyses concerned with technological processes associated with certain sub-categories of the site inventories -- for example as related to the production of blades or axes [@damlien2016]. Some studies have attempted more comprehensive evaluations of a number of lithic inventories to get at potential site types [@viken2018; @breivik2020], but these have been conducted without support from quantitative frameworks that can help structure such analyses, and have treated site type as a categorical variable with three categories. In sum therefore, previous studies are typically either limited to a small number of sites, to a subset of the inventories, or to narratively and subjectively driven methods. The analysis conducted here employs multivariate exploratory statistics using the entirety of the lithic assemblages associated with a larger number of sites. This is done to identify latent patterns and structure in the relationship between these, with the ultimate aim of identifying behaviourally induced variation in their composition across time and space. However, the composition of the assemblages can be expected to be determined by a multitude of factors [e.g. @dibble2017], ranging from the impact of natural formation processes, to various and intermixed behavioural aspects such as purpose, duration, frequency, and group sizes at visits to the sites. Furthermore, the assemblages are also likely to be impacted by variation in lithic technology, artefact function, use-life and discard patterns, as well as access to raw materials. Finally, analytical and methodological dimensions relating to survey, excavation and classification practices will also influence how the assemblages are defined. Consequently, the analysis conducted here is done from an exploratory perspective, where all of these factors should be seen as potential contributors to any observed pattern. In this light, the following sections will present the data to be analysed, a few potential sources of bias that might affect the comparisons to be conducted, while also highlighting a few ways in which idiosyncrasies in the chosen material might alleviate some of these issues.

## Material

```{r get-data, eval = TRUE}
sites <- read.csv(here::here('analysis/data/raw_data/Roalkvam_DialPast_March2021_data.csv'))

```

```{r wrangling}
sites <- sites %>% 
      # Find mean age for each site (to be used in the plot below)
  rowwise() %>% 
  mutate(mean_date = mean(c(reported_start_bp, reported_end_bp)),
         .keep = "unused") %>% 
  mutate(
    artefact_count = sum(c_across(core:flake_retouch_other))) %>% 
  filter(artefact_count > 100)
  

lithics <- sites %>%
  # Combine flint projectiles into a single variable
  mutate(
    projectile = microlith + tanged_point + transverse_point + 
    single_edged_point + hognipen_point + projectile_undefined,
    small_tool = scraper + knife + burin + drill + blade_retouch + 
      microblade_retouch + chip_retouch + fragment_retouch + flake_retouch,
    macro_tool = axe + chisel, 
    macro_tool_other = axe_other + chisel_other + club_hatchet_other,
    small_tool_other = knife_other + scraper_other + drill_other + 
      microblade_retouch_other + blade_retouch_other + fragment_retouch_other +
      flake_retouch_other,
    .keep = "unused") %>%
  # Make site names the rownames
  column_to_rownames(var = "site") %>% 
  # Deselect a few of the columns not be used
  select(-one_of(c("n", "excavation_project", "excavated_m3")))
```

```{r cor1, fig.cap = "Correspondence analysis using artefact count data.", fig.height = 8, fig.width = 10}
# Perform correspondence analysis on the data. 'mean_age' is meant for colouring
# so is excluded here
calithics <- CA(select(lithics, -mean_date, -artefact_count), graph = FALSE)

# Retrieve eigenvalues
eigval <- get_eigenvalue(calithics)
explained_cumul_dim2 <- eigval[2,3]

# Find date to hold the central tendency date
centdate <- (sum(range(lithics$mean_date)) / 2) / 1000

# Plot with site names tags (probably most immediately relevant for an audience 
# familiar with the sites)
fviz_ca_row(calithics, col.row = "black", fill = lithics$mean_date / 1000, title = "A",
                     repel = TRUE, shape = 21, pointsize = 2.9) +
  scale_fill_gradient2(name = "ka BP", low="yellow", mid="orange", 
                        high="red", midpoint = centdate) +
  theme(legend.position = "bottom") 
```

```{r cor, fig.cap = "Correspondence analysis using artefact count data. A) Object map, B) Variable map.", fig.height = 13}
# Plot without site names tags
plt1 <- fviz_ca_row(calithics, geom = "point", col.row = "black", fill = lithics$mean_date / 1000, title = "A",
                     repel = TRUE, shape = 21, pointsize = 2.9) +
  scale_fill_gradient2(name = "ka BP", low="yellow", mid="orange", 
                        high="red", midpoint = centdate) +
  theme(legend.position = "bottom") 
#guide(fill = guide_legend(reverse = TRUE)) # Reverses the legend but makes it
                                            # discrete

# Plot variables
plt2 <- fviz_ca_col(calithics, col.col = "black", repel = TRUE, title = "B") 

plt1 /
plt2

```

Figure \@ref(fig:cor) displays a CA using the lithic count data. While no clear-cut clusters can be readily delineated, the general impression from the plots is still that a chronological dimension is associated with the patterning in the data. This is indicated by the general transition across the colour scale in the row plot, combined with the fact that the two first dimensions of the CA-analysis account for as much as `r round(explained_cumul_dim2, 2)` % of the inertia or variance in the data. The earliest sites tend to be located in the upper right corner of plot A, with increasingly younger sites towards the bottom along the second dimension. The sites from the later parts of the Mesolithic are drawn out along the first dimension of the plot, and are not as impacted by the second dimension.

The column plot reveals that the earliest sites are characterised by the flint artefact categories microburins, projectiles, as well as macro tools and associated debitage. It is also interesting that these sites to larger extent are characerised by core fragments, both in flint and non-flint materials, while the cores themselves appear to be a trait more defining of assemblages with later dates. The non-flint material on the earliest sites appears to be centered around the production of projectiles, as both the projectiles themselves and non-flint blades are important constituents of the assemblages at these sites.

The first dimension, which is pulling some of the later sites towards the right of the plot, is mainly defined by macro tools and associated debitage in non-flint materials that are negatively correlated with more flint dominated assemblages and non-flint projectiles. While the outer end of the first dimensions is dominated by later Mesolithic sites such as Stokke/Polland 3, Vallermyrene 4 and GunnarsrÃ¸d 10, which are all associated with axe production in non-flint materials, the later Mesolithic sites occur along the entire dimension, indicating that while these axe production sites are a feature of the later Mesolithic, there is marked variation among these later sites. Although the sample size is quite strained and the discussion of finer chronological points might not be warranted, the first dimension does appear to be of of less importance for the absolute latest sites, as indicated by their location to the left of the plot. This could indicate that specialised axe production sites disappear towards the end of the Mesolithic, a notion that would be in line with previous research.

In addition, Nedre Hobekk 2 represents a somewhat curious case in that its assemblage is dominated by axe production in metarhyolite. The use of metarhyolite is typically seen as a feature of the end of the EM and the MM, but is evidently not as prominent a part of other sites that are contemporaneous with Nedre Hobekk 2. T

```{r pcadata}
# Tried to do this to avoid having to type the variable names into both mutate()
# and select(). The general syntax select(-(vector_of_variable_names)) worked,
# but not: mutate(new_varaible = sum(vector_of_variable_names) / artefact_count)
primary_lithics <- c("core", "core_fragment", "blade", "microblade", "chip",
                     "fragment", "flake", "flake_other", "fragment_other", 
                     "chip_other", "blade_other",  "microblade_other", 
                     "core_other", "core_fragment_other")

secondary_lithics <- c("axe_debitage", "axe", "chisel", "microlith", 
"tanged_point", "transverse_point", "single_edged_point", "hognipen_point",
"projectile_undefined", "microburin", "scraper", "knife", "burin", "drill", 
"blade_retouch", "microblade_retouch", "chip_retouch", "fragment_retouch",
"flake_retouch", "axe_other", "axe_debitage_other", "chisel_other",
"club_hatchet_other", "grinding_slab_stone", "projectile_point_other",
"knife_other", "scraper_other", "drill_other", "microblade_retouch_other", 
"blade_retouch_other", "fragment_retouch_other", "flake_retouch_other")

lithics2 <- sites %>% 
  select(-n, -beach_flint_flint_nodule, -hammerstone, -excavation_project) %>% 
  # The reason for not using .keep below is for the option to retain artefact_count
  mutate(chip_freq =  sum(chip, chip_other) / artefact_count,
         core_freq = sum(core, core_other) / artefact_count,
         primary_freq = sum(core, core_fragment, blade, 
                     microblade, chip, fragment, flake, flake_other, 
                     fragment_other, chip_other, blade_other,  microblade_other, 
                     core_other, core_fragment_other) / artefact_count,
         secondary_freq =  sum(axe_debitage, axe, chisel, 
                microlith, tanged_point, transverse_point, single_edged_point,
                hognipen_point, projectile_undefined, microburin, scraper, 
                knife, burin, drill, blade_retouch, microblade_retouch, 
                chip_retouch, fragment_retouch, flake_retouch, axe_other,
                axe_debitage_other, chisel_other, club_hatchet_other, 
                grinding_slab_stone, projectile_point_other, knife_other,
                scraper_other, drill_other, microblade_retouch_other, 
                blade_retouch_other, fragment_retouch_other,
                flake_retouch_other) / artefact_count,
         lithic_dens = artefact_count / excavated_m3) %>%
  select(-primary_lithics, -secondary_lithics, -excavated_m3, -artefact_count) %>% 
  column_to_rownames("site")
```

```{r wabi, fig.cap = "Whole-assemblage behavioural index", fig.height = 5, fig.width = 10}

ggplot(lithics2, aes(log10(lithic_dens), log10(secondary_freq), 
                     fill = mean_date / 1000)) + 
  geom_point(shape = 21, size = 3) +
  geom_smooth(method = "lm", col = "black", se = FALSE) +
  labs(x = "Lithic volumetric density (log10)", 
       y = "Relative frequency of secondarily worked lithics (log10)") +
  scale_fill_gradient2(name = "ka BP",  low="yellow", mid="orange", 
                        high="red", midpoint = centdate) +
  theme_classic()

wabicor <- cor(log10(lithics2$lithic_dens), log10(lithics2$secondary_freq))
```

Figure \@ref(fig:wabi) displays the WABI as found for the site data. This indicates a negative correlation between the two variables (pearsons r = `r round(wabicor, 2)`) and a general tendency for younger sites to be associated with a higher volumetric density of lithics and a lower relative frequency of secondarily worked lithics than older sites.

```{r pca-analysis, fig.cap = "PCA.", fig.height = 7, fig.width = 10}
pcalithics <- PCA(select(lithics2, -mean_date), scale.unit = TRUE, graph = FALSE)
fviz_pca(pcalithics, geom.ind = "point", fill.ind = lithics2$mean_date / 1000, 
          repel = TRUE, col.var = "black", pointshape = 21,  pointsize = 2.9,
         title = "") + 
  scale_fill_gradient2(name = "ka BP",  low="yellow", mid="orange", 
                        high="red", midpoint = centdate) +
  theme(legend.position = "bottom") 

```

Figure \@ref(fig:pca-analysis) displays a principle components analysis using variations of the continuous measures for degree of mobility as operationalised by @Bicho2020. While the investigation performed by @Bicho2020 indicates that the relative frequency of chips, cores, and blanks might be more sensitive to mobility patterns than the volumetric density of lithics, and the frequency of retouched artefacts, these last dimensions are capturing the most variation in the dataset presented here. If frequency of secondarily worked artefacts is taken as a proxy for mobility, these findings would consequently be in line with previous research into the Mesolithic of Norway, indicating that earlier sites are associated with higher degree of mobility that sites from later phases. @Bicho2020 also found that WABI, as introduced by, gave a reasonable estimation of mobility in their data. The same is evident here where fig indicates a

```{r eigenvalues, fig.cap = "Table showing the eigenvalues of the components."}
# Scree plot indicates an 'elbow' at the second dimension. 
# The two first dimension account for 68 % and the first three
# for 87 % (see table below)
# fviz_screeplot(pcalithics, addlabels=TRUE)

# Create a table showing the eigenvalues of the components
round(as.tibble(get_eig(pcalithics)), 2) %>% 
  rename("Eigenvalue" = eigenvalue, "Variance (%)" = variance.percent, 
         "Cumulative variance (%)" = cumulative.variance.percent) %>% 
  rownames_to_column(var = "Component") %>% 
gt(rowname_col = "row", auto_align = FALSE)
```

```{r var_contrib, fig.cap = "Contribution of variables to components."}
# The plots below investigates the contribution of the variables to the
# components. The code has in large part been taken from 
# Bicho & Cascalheira (2020).
var <- get_pca_var(pcalithics)
dim1 <- fviz_contrib(pcalithics, choice = "var", axes = 1,
                     color = "black", fill = "gold2", 
                     title = "Contribution of variables to Component 1")
dim2 <- fviz_contrib(pcalithics, choice = "var", axes = 2, 
                     color = "black", fill = "gold2", 
                     title = "Contribution of variables to Component 2")
dim3 <- fviz_contrib(pcalithics, choice = "var", axes = 3,
                     color = "black", fill = "gold2", 
                     title = "Contribution of variables to Component 3")
dim4 <- fviz_contrib(pcalithics, choice = "var", axes = 4,
                     color = "black", fill = "gold2", 
                     title = "Contribution of variables to Component 4")

# Patchwork for arranging plots
(dim1 | dim2) /
(dim3 | dim4)
```

```{r var_cor, fig.cap = "Plots showing the correlation between the variables"}
plt1 <- fviz_pca_var(pcalithics,
                  col.var = "black",
                  title = "Correlation plot: Component 1/Component 2",
                  repel = TRUE
                  )
plt2 <- fviz_pca_var(pcalithics,
                  col.var = "black",
                  axes = 3:4,
                  title = "Correlation plot: Component 3/Component 4",
                  repel = TRUE
                  )

plt1 + plt2
```

The consistent nature of the WABI between this study (r = -0.50), @clark2017 (r = -0.50), @Bicho2020 (r = -0.48) is striking, and should speak to the cross-cultural and cross-temporal applicability of the WABI measure for lithic assemblages stemming from hunter-gatherer(-fisher) societies, and the potential it holds for comparative studies. The findings indicated by the WABI, as well as by the negative correlation between relative frequency of primarily and secondarily worked lithics, do align more clearly with previous suggestions concerning the overall mobility patterns in Mesolithic Norway. However, while this can perhaps support the of the . The question then becomes what is the significance of the negatively correlated variables of relative frequency of cores and chips? Given that these are more or less orthogonal to the WABI variables on the first and second component, this would indicate that if one of these variable pairs is taken to reflect the of expedient and curated assemblages, it should follow that the other variable pairs is not correlated with these. As the entire temporal range of the sites is spread out between the extremes of the chip and core variables, another possibility is that these are indicative of site that are temporally ubiquitous. In attempt to determine if this might be the case, it was decided to introduce locational data from a previous study that in addition to surveyed sites involved the analysis of the sites treated here @roalkvam2020. This found that the most consistently important locational variable for the sites in the region was the exposure of the sites to elements, and failed to identify any diachronic variation in this pattern. As it has previously been proposed that sites located in areas exposed to wind and waves and with large overview of surrounding areas is a characteristic of hunting stations or similar, one could envisage that variablity in site functionality indicated by the core to chip correlation might be reflected in variation in degree of exposure.

This is arguably more established than the variables included bysimilarities between the variable plots of @Bicho2020 and the variables indicated in is striking. This pertains to the negative correlation between core and chip frequency, and the negative correlation between primary and secondarily worked lithics. This last

<!-- The following line inserts a page break  -->

\newpage

# References

<!-- The following line ensures the references appear here for the MS Word or HTML output files, rather than right at the end of the document (this will not work for PDF files):  -->

::: {#refs}
:::

\newpage

### Colophon

This report was generated on `r Sys.time()` using the following computational environment and dependencies:

```{r colophon, cache = FALSE}
# which R packages and versions?
if ("devtools" %in% installed.packages()) devtools::session_info()
```

The current Git commit details are:

```{r}
# what commit is this file at? 
if ("git2r" %in% installed.packages() & git2r::in_repository(path = ".")) git2r::repository(here::here())  
```
